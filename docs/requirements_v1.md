# QuitBuddy 戒烟 App V1.0 需求文档

## 1. 项目概述

- **目标**：帮助用户制定戒烟计划、识别触发因素、使用微干预度过渴求、量化收益并提升坚持率。
- **平台/技术约束**：Android（Java），使用 AndroidX/Jetpack 组件。
- **最小支持版本**：Android 8.0（API 26）。
- **离线优先**：核心功能离线可用；云同步作为可选开关。
- **商业约束**：无广告追踪、隐私优先、免费核心功能。

## 2. 范围

### 范围内

- Onboarding 流程
- 仪表盘
- 渴求记录与历史
- 微干预工具（呼吸、延迟、替代建议）
- 通知（固定、高风险、里程碑）
- 成就与勋章
- 数据导出
- 设置（云同步开关、主题、通知等）
- App Widget

### V1 不做

- 医疗诊断或处方
- 内容社区
- 复杂账号体系
- 深度 AI 个性化干预

## 3. 目标用户与核心价值

- **新手戒烟者**：提供清晰引导与高频正反馈。
- **反复戒烟者**：支持复吸后低羞耻成本重启。
- **数据敏感型用户**：提供金钱、时间、健康收益量化。

**关键价值**：快速记录、及时干预、可视化进步、里程碑激励、个性化提醒。

## 4. 关键指标（KPI）

- D1 留存率 ≥ 45%
- D7 留存率 ≥ 20%
- 平均无烟连续天数 ≥ 7
- App 评分 ≥ 4.7
- 崩溃率 ≤ 0.3%

## 5. 用户旅程

1. 首次启动 → Onboarding（设定起始日/基线/价格/每包支数，选择固定提醒时段）
2. 日常使用 → 仪表盘查看进度 → 记录渴求 → 启动微干预
3. 触发前提醒 → 高风险时段前置通知
4. 复吸 → 温和记录 → 连续计数重置（累计收益保留）

## 6. 功能需求

### 6.1 Onboarding（首次设置）

- 要素：模式（完全戒/逐步减少—V1 仅展示）、起始日、每日基线、每包支数、价格、固定提醒时段（1–3 个）。
- 结果：写入计划；进入仪表盘；设置可二次修改。
- 验收：
  - **Given** 必填已填，**When** 点击完成，**Then** 1 秒内进入仪表盘并可在设置中查看与修改。
  - **Given** 未填必填，**When** 点击完成，**Then** 阻止并提示缺失项。

### 6.2 仪表盘

- 展示：无烟天数、节省金额、避免香烟数、下一里程碑。
- 动作：快速记录渴求、打开微干预。
- 刷新：前台每 60 秒计算一次；返回时即刻刷新。
- 验收：
  - **Given** 计划存在，**When** 打开仪表盘，**Then** 指标显示且与设置一致。
  - **Given** 数据更新，**When** 回到仪表盘，**Then** 60 秒内刷新。

### 6.3 渴求记录与历史

- 字段：强度 1–10、触发情景（咖啡/酒精/压力/社交/驾驶/独处/其他）、是否吸烟、备注。
- 历史：按时间倒序，支持过滤（触发/是否吸）与搜索（备注）。
- 反馈：保存后显示微成就提示。
- 验收：
  - **Given** 表单完成，**When** 点击保存，**Then** 本地落库并立即显示在首行。
  - **Given** 过滤条件，**When** 应用过滤，**Then** 列表仅显示匹配项。

### 6.4 微干预工具

- 呼吸练习：4–4–4–4 节律，60–120 秒，引导动效与文本提示。
- 延迟计时：3 分钟倒计时；可暂停/继续；前后台状态安全。
- 替代建议：本地短文案库，随机或按触发情景推荐。
- 验收：
  - **Given** 练习进行中，**When** App 退至后台再返回，**Then** 状态不丢失。
  - **Given** 计时结束，**When** 回到工具页，**Then** 出现鼓励提示与下一步建议。

### 6.5 通知（本地）

- 固定提醒：用户选择 1–3 个时段；每日重复。
- 高风险提醒：近 7 天事件时间分布，选 Top2 小时段，提前 10–15 分钟提醒。
- 里程碑提醒：达成当日 9:30 发送；与固定提醒去重。
- 验收：
  - **Given** 用户授权提醒，**When** 到达时刻，**Then** 通知必达且点击可跳转目标页。
  - **Given** 无授权，**When** 安排提醒，**Then** 给予明确授权引导并保持稳定。

### 6.6 成就与勋章

- 节点：3/7/14/30/90/180/365 天；连续 7 日未吸。
- 展示：弹窗祝贺、成就列表页。
- 验收：
  - **Given** 达成节点，**When** 打开 App 或到设定提醒，**Then** 出现祝贺并记录达成时间。

### 6.7 数据导出

- 格式：CSV；字段含时间/强度/触发/是否吸/备注。
- 分享：系统分享面板。
- 验收：
  - **Given** 存在记录，**When** 导出，**Then** 生成 UTF-8 CSV 并可分享。
  - **Given** 无记录，**When** 导出，**Then** 生成带表头空文件并提示。

### 6.8 设置

- 云同步开关：默认关闭；开启后启用云端读写与后台同步任务。
- 主题：系统/浅色/深色；强调色选择器。
- 隐私：数据清除、数据导出、隐私说明链接。
- 通知：固定时段管理、测试通知按钮。
- 验收：
  - **Given** 切换云同步开关，**When** 返回应用，**Then** 后台策略与状态与开关一致。
  - **Given** 修改主题/颜色，**When** 返回任何页面，**Then** 立即生效。

### 6.9 小组件（App Widget）

- 尺寸：小号/中号。
- 内容：无烟天数、节省金额；点击打开 App。
- 数据源：从本地快照读取（与主进程一致）。
- 刷新：定时 + App 更新后触发刷新。
- 验收：
  - **Given** 首次添加，**When** 30 秒内，**Then** 显示占位后更新为真实数据。
  - **Given** App 内数据变化，**When** 回到桌面，**Then** 10 秒内刷新。

## 7. 数据设计

### 7.1 QuitPlan 实体

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| startDate | 日期 | 起始日 |
| mode | 文本 | coldTurkey/gradual |
| dailyBaseline | 数值 | 每日基线（支/日） |
| pricePerPack | 数值 | 价格 |
| cigsPerPack | 数值 | 每包支数 |

### 7.2 CravingEvent 实体

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| timestamp | 日期 | 事件时间 |
| intensity | 数值 | 强度 1–10 |
| trigger | 文本 | 触发情景 |
| didSmoke | 布尔 | 是否吸烟 |
| note | 文本 | 备注 |

### 7.3 Widget 快照

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| days | 数值 | 无烟天数 |
| money | 数值 | 累计节省 |
| updatedAt | 日期 | 更新时间 |

### 7.4 核心公式

- 无烟天数：当前日期 − startDate（向下取整，按本地时区）。
- 避免香烟数：`dailyBaseline × 已过天数 − 实际吸烟次数`。
- 节省金额：`避免香烟 ÷ cigsPerPack × pricePerPack`。
- 时间回收：`避免香烟 × 8 分钟/支`。

## 8. 非功能性需求

- 性能：冷启动 ≤ 1.5 秒；主线程负载 ≤ 16 ms；列表滚动 60 fps。
- 稳定性：崩溃率 ≤ 0.3%。
- 可靠性：本地写入成功率 ≥ 99.9%；导出文件可用。
- 离线能力：核心功能离线可用；网络仅用于云同步。
- 电量：后台任务合并执行；闹钟仅关键时刻精确触发。
- 可访问性：TalkBack 标签完整；字体缩放；对比度达标。
- 本地化：提供简体中文与英文；货币与日期遵循系统设置。

## 9. 通知策略

- 固定提醒：每日重复；允许用户设置 1–3 个时段。
- 高风险提醒：近 7 天按小时统计，取 Top2，提前 10–15 分钟推送。
- 里程碑提醒：当天 9:30 发送；与固定提醒去重。
- 用户控制：所有提醒可单独关闭；支持安静时段（V1 可选）。

## 10. 云同步（可选）

- 开关：默认关闭；开启后进行云端读写与周期同步。
- 身份：匿名，支持单用户多设备。
- 一致性：最后写入优先，使用 `updatedAt` 解决冲突。
- 离线策略：离线时可继续使用；恢复联网后增量同步。
- 关闭行为：取消后台同步；本地数据保留。

## 11. 主题与图标

- 主题：System、Light、Dark；支持强调色自定义，需全局即时生效。
- 图标：Adaptive Icon；深浅色前景对比合规。

## 12. 隐私与合规

- 权限：仅请求通知权限；不采集位置、通讯录或电话数据。
- 数据：默认保存在本地；云同步由用户选择；提供导出与清除能力。
- 隐私说明：明确声明“非医疗诊断，仅自助管理”。

## 13. 质量与测试

### 必测用例

- Onboarding 完整流程；设置修改后正确回显。
- 指标计算跨日正确（基于本地时区）。
- 渴求记录在 1,000 条内滚动流畅。
- 固定/高风险/里程碑通知到达并能去重。
- 导出 CSV 可被打开且编码正确。
- Widget 首次加载与后续刷新正常。
- 云同步开关切换稳定。
- TalkBack、字体缩放、深色模式表现正常。

### 性能检查

- 冷启动时间、帧率、主线程卡顿、后台任务频率。

## 14. 发布物料（Google Play）

- 截图：竖屏 1080×1920；横屏 1920×1080。
- Feature Graphic：1024×500。
- 图标：512×512 源图。
- 文案：标题、副标题、要点、隐私政策链接。
- 内容分级：健康辅助；无用户生成内容；无广告。

## 15. 风险与缓解

- 厂商后台限制：核心提醒使用精确闹钟；提供“保持通知稳定”指引。
- 多设备冲突：以时间戳合并；必要时提示“以最新为准”。
- 数据丢失：关键写入落盘；提供导出能力；异常场景重试。
- 授权拒绝：软引导、功能降级、不强迫。

## 16. 版本规划

- **V1.0**：本需求所列全部功能。
- **V1.1**：趋势图/热力图、安静时段、证书分享、导出筛选。
- **V1.2**：Wear OS、快捷方式与磁贴、更多干预模块。

## 17. 验收标准（摘要）

- Onboarding 可在 3 分钟内完成并进入仪表盘。
- 渴求记录保存 ≤ 150 ms 并立即可见。
- 指标与里程碑计算准确，跨日滚动正确。
- 固定/高风险/里程碑提醒可验证到达且点击可跳转。
- 导出 CSV 正确，Widget 占位至真值 ≤ 30 秒，数据更新至刷新 ≤ 10 秒。
- 云同步开关切换稳定，离线/在线一致性可验证。
- 可访问性通过基础审查；深色模式与动态字体无布局错乱。
